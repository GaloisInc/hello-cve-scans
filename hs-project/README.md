# Haskell CVE Scanning
## Choices

First of all, Haskell does have its own security advisory database
https://github.com/haskell/security-advisories.  From the
README.md: The Haskell Security Advisory Database is a repository of
security advisories filed against packages published via Hackage.

Some CVE scan tool alternatives:

 1. The cabal-audit in hackage, source here
    https://github.com/joelteon/cabal-audit.git
    This is 11 years old and no one is using it.  Skipping this.

 2. https://github.com/TristanCacqueray/cabal-audit/

    Incomplete; it seems to be a student project.  From the README.md:

        This project differs from the other cabal-audit by using the
        program call graph instead of the install plan in order to avoid
        false positives. For example, HSEC-2023-007 may not be an issue
        if the affected declaration is not used (even through a
        transitive dependency).

    Skipping this one too.

 3. https://github.com/MangoIV/cabal-audit This has some issues, but
    it is actively maintained.  It calls the cabal library and uses
    the "official" Haskell Security Advisory Database.
    MangoIV, the author, seems to have some connections to the *The
    Haskell Security Advisory Database* group.

So, the best of some (not great) alternatives appears to be (3.)
MangoIV/cabal-audit.

## MangoIV's cabal-audit
### Install

Unfortunately, this package is not in hackage, so you need to install
it from the source code.

```
 SRC=YOUR_DIRECTORY_HERE

 cd $SRC
 # install cabal-audit
 gh repo clone MangoIV/cabal-audit MangoIV/cabal-audit
 cd MangoIV/cabal-audit
 cabal install

 # acquire local copy of security-advisories [workaround for bug]
 cd $SRC
 gh repo clone haskell/security-advisories haskell/security-advisories
```

The above will result in `cabal-audit` added to your PATH (if you've
setup cabal and your PATH correctly).

### Problem, with Work-Around

**A Problem.** cabal-audit`, **like other scan tools behave** will
download the security database and use that to scan the libraries.
However, a recent build (7400bee1 Jul 28 2024) of `cabal-audit`
resulted in internal errors due to it being unable to parse the (then
current) security database.

**Workaround:** As seen in the instructions, to workaround this we can
separately download the security-advisory database, we'll point
`cabal-audit` to it.

### Running `cabal-audit`

To run cabal-audit on our sample Haskell program:

```
  cd rust-project/
  cabal-audit -p $SRC/haskell/security-advisories
```
and you should then see
```
Resolving dependencies...

Found advisories:

dependency "base" at version 4.17.2.1 is vulnerable for:
  HSEC-2023-0007 "readFloat: memory exhaustion with large exponent"
  published: 2023-07-22 02:29:32 UTC
  https://haskell.github.io/security-advisories/advisory/HSEC-2023-0007
  No fix version available
  toml, parser, dos
```

(Note, the above advisory is a obscure [but real] bug in ghc's `base`
library that currently has no fix.)

### Comments

A flaw in `cabal-audit` that does not exist in the other scan tools
(for python and rust) is that `cabal-audit`
 - always calls cabal (the library) to do the "package resolve"
   function, and does not allow for the reading of "cabal freeze" files.
 - to make matters worse, it does not allow for any passing of
   arguments from the command line to the invocation.  This severely
   limits the ability of the tool to be used with non-trivial cabal builds.
